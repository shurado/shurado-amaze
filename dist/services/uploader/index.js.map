{"version":3,"sources":["../../../src/services/uploader/index.js"],"names":["config","update","accessKeyId","process","env","AWS_ACCESS_KEY","secretAccessKey","AWS_SECRET_KEY","s3","S3","params","Bucket","s3Config","bucket","acl","key","req","file","cb","originalname","feedUploader","limit","storage","avatarUploader"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,iBAAOA,MAAP;;AAEA,iBAAIA,MAAJ,CAAWC,MAAX,CAAkB;AAChBC,eAAaC,QAAQC,GAAR,CAAYC,cADT;AAEhBC,mBAAiBH,QAAQC,GAAR,CAAYG;AAFb,CAAlB;;AAKA;;;;;;;AAOA,IAAMC,KAAK,IAAI,iBAAIC,EAAR,CAAW,EAAEC,QAAQ,EAAEC,QAAQ,OAAV,EAAV,EAAX,CAAX;AACA,IAAMC,WAAW,uBAAS;AACxBJ,MAAIA,EADoB;AAExBK,UAAQ,OAFgB;AAGxBC,OAAK,aAHmB;AAIxBC,OAAK,aAASC,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;AAC3BA,OAAG,IAAH,EAAS,UAAUD,KAAKE,YAAxB;AACD;AANuB,CAAT,CAAjB;;AAUO,IAAMC,sCAAe,sBAAO;AACjCC,SAAO,OAAO,IAAP,GAAc,IADY;AAEjCC,WAASV;AAFwB,CAAP,CAArB;;AAKA,IAAMW,0CAAiB,sBAAO;AACnCF,SAAO,OAAO,IAAP,GAAc,CADc;AAEnCC,WAASV;AAF0B,CAAP,CAAvB","file":"index.js","sourcesContent":["import multer from 'multer';\nimport multerS3 from 'multer-s3';\nimport AWS from 'aws-sdk';\nimport dotenv from 'dotenv';\nimport fs from 'fs';\ndotenv.config();\n\nAWS.config.update({\n  accessKeyId: process.env.AWS_ACCESS_KEY,\n  secretAccessKey: process.env.AWS_SECRET_KEY,\n});\n\n/* 1. 使用者上傳圖片時，根據使用者 id 建立資料夾\n * 2. 分為 feed 跟 avatar \n * 3. handle progress\n * feed_timestamp\n * avatar_timestamp\n*/\n\nconst s3 = new AWS.S3({ params: { Bucket: 'yaoya' }});\nconst s3Config = multerS3({\n  s3: s3,\n  bucket: 'yaoya',\n  acl: 'public-read',\n  key: function(req, file, cb) {\n    cb(null, 'user/' + file.originalname);\n  }\n});\n\n\nexport const feedUploader = multer({\n  limit: 1024 * 1024 * 1024,\n  storage: s3Config,\n})\n\nexport const avatarUploader = multer({\n  limit: 1024 * 1024 * 2,\n  storage: s3Config\n});\n"]}