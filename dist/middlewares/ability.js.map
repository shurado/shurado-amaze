{"version":3,"sources":["../../src/middlewares/ability.js"],"names":["ability","basicPolicy","model","req","res","next","modelType","constructor","name","method","toLowerCase","status","json","ownerOnly","user","user_id","id"],"mappings":";;;;;kBA+CwBA,O;;AA9CxB,IAAMC,cAAc,SAAdA,WAAc,CAACC,KAAD;AAAA,SAAW,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjD,QAAMC,YAAYJ,MAAMK,WAAN,CAAkBC,IAApC;;AAEA;AACA,QAAIL,IAAIM,MAAJ,CAAWC,WAAX,OAA6B,KAAjC,EAAwC;AACtC,aAAON,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB,CAAP;AACD;;AAED,QAAI,CAACN,SAAL,EAAgB;AACd,aAAOD,MAAP;AACD;;AAED,YAAQC,SAAR;AACE,WAAK,MAAL;AACE,eAAOD,MAAP;AACF,WAAK,MAAL;AACE,eAAOA,MAAP;AACF,WAAK,SAAL;AACE,eAAOA,MAAP;AACF,WAAK,MAAL;AACE,eAAOA,MAAP;AACF;AACE,eAAOD,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB,CAAP;AAVJ;AAYD,GAxBmB;AAAA,CAApB;;AA0BA,IAAMC,YAAY,SAAZA,SAAY,CAACX,KAAD;AAAA,SAAW,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC/C,QAAMS,OAAOX,IAAIW,IAAjB;AACA,QAAMR,YAAYJ,MAAMK,WAAN,CAAkBC,IAApC;;AAEA,QAAIL,QAAQ,KAAZ,EAAmB;AACjB,cAAQG,SAAR;AACE,aAAK,MAAL;AACA,aAAK,SAAL;AACE,iBAAOJ,MAAMa,OAAN,KAAkBD,KAAKE,EAAvB,GAA4BX,MAA5B,GAAqCD,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB,CAA5C;AACF,aAAK,MAAL;AACE,iBAAOE,KAAKE,EAAL,KAAYd,MAAMc,EAAlB,GAAuBX,MAAvB,GAAgCD,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB,CAAvC;AACF;AACE,iBAAOR,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB,CAAP;AAPJ;AASD;;AAEDR,QAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB;AACD,GAjBiB;AAAA,CAAlB;;AAoBe,SAASZ,OAAT,CAAiBE,KAAjB,EAAwB;;AAErC,SAAO,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC9BJ,gBAAYC,KAAZ,EAAmBC,GAAnB,EAAwBC,GAAxB,EAA6BC,IAA7B;AACD,GAFD;AAGD","file":"ability.js","sourcesContent":["\nconst basicPolicy = (model) => (req, res, next) => {\n  const modelType = model.constructor.name;\n\n  /* can only read */\n  if (req.method.toLowerCase() !== 'get') {\n    return res.status(401).json(null);\n  }\n\n  if (!modelType) {\n    return next();\n  }\n\n  switch (modelType) {\n    case 'feed':\n      return next();\n    case 'user':\n      return next();\n    case 'comment':\n      return next();\n    case 'spot':\n      return next();\n    default:\n      return res.status(401).json(null);\n  }\n}\n\nconst ownerOnly = (model) => (req, res, next) => {\n  const user = req.user;\n  const modelType = model.constructor.name;\n\n  if (req !== 'get') {\n    switch (modelType) {\n      case 'feed':\n      case 'comment':\n        return model.user_id === user.id ? next() : res.status(401).json(null);\n      case 'user':\n        return user.id === model.id ? next() : res.status(401).json(null);\n      default:\n        return res.status(401).json(null);\n    }\n  }\n  \n  res.status(401).json(null);\n}\n\n\nexport default function ability(model) {\n\n  return function(req, res, next) {\n    basicPolicy(model)(req, res, next);\n  };  \n}\n"]}