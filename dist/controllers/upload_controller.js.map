{"version":3,"sources":["../../src/controllers/upload_controller.js"],"names":["require","Router","multer","v1","BufferStream","S3Uploader","route","uploader","post","single","req","res","next","bufferStream","file","buffer","accessKeyId","process","env","AWS_ACCESS_KEY_ID","secretAccessKey","AWS_SECRET_ACCESS_KEY","bucket","S3_BUCKET","region","upload","key","body","json","module","exports"],"mappings":";;eAAmBA,QAAQ,SAAR,C;IAAXC,M,YAAAA,M;;AACR,IAAMC,SAASF,QAAQ,QAAR,CAAf;AACA,IAAMG,KAAKH,QAAQ,SAAR,CAAX;;AAEA,IAAMI,eAAeJ,QAAQ,qCAAR,CAArB;AACA,IAAMK,aAAaL,QAAQ,wBAAR,CAAnB;;AAGA,IAAMM,QAAQ,IAAIL,MAAJ,EAAd;AACA,IAAMM,WAAWL,QAAjB;;AAEAI,MAAME,IAAN,CAAW,SAAX,EAAsBD,SAASE,MAAT,CAAgB,QAAhB,CAAtB,EAAiD,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACnE,MAAMC,eAAe,IAAIT,YAAJ,CAAiBM,IAAII,IAAJ,CAASC,MAA1B,CAArB;AACA,MAAMR,WAAe,IAAIF,UAAJ,CAAe;AAClCW,iBAAaC,QAAQC,GAAR,CAAYC,iBADS;AAElCC,qBAAiBH,QAAQC,GAAR,CAAYG,qBAFK;AAGlCC,YAAQL,QAAQC,GAAR,CAAYK,SAHc;AAIlCC,YAAQ;AAJ0B,GAAf,CAArB;;AAOAjB,WAASkB,MAAT,CAAgB,CAAC;AACfC,SAAKvB,OAAO,MADG;AAEfwB,UAAMd;AAFS,GAAD,CAAhB;;AAKAF,MAAIiB,IAAJ,CAAS,EAAT;AACD,CAfD;;AAiBAC,OAAOC,OAAP,GAAiBxB,KAAjB","file":"upload_controller.js","sourcesContent":["const { Router } = require('express');\nconst multer = require('multer');\nconst v1 = require('uuid/v1');\n\nconst BufferStream = require('../services/S3Uploader/BufferStream');\nconst S3Uploader = require('../services/S3Uploader');\n\n\nconst route = new Router();\nconst uploader = multer();\n\nroute.post('/upload', uploader.single('avatar'), (req, res, next) => {\n  const bufferStream = new BufferStream(req.file.buffer);\n  const uploader     = new S3Uploader({\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\n    bucket: process.env.S3_BUCKET,\n    region: 'us-west-2'\n  });\n\n  uploader.upload([{\n    key: v1() + '.jpg',\n    body: bufferStream\n  }]);\n\n  res.json({});\n});\n\nmodule.exports = route;\n"]}