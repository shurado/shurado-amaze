{"version":3,"sources":["../src/app.js"],"names":["express","require","path","logger","bodyParser","cookieParser","passport","graphqlHTTP","routes","schema","auth","app","get","disable","set","join","__dirname","use","static","maxAge","setHeaders","res","setHeader","Date","now","skip","process","env","NODE_ENV","req","next","header","json","urlencoded","extended","secret","SECRET_KEY","resave","saveUninitialized","initialize","session","graphiql","init","registerRoutes","err","Error","status","render","console","warn","stack","log","message","accepts","error","name","text","module","exports"],"mappings":"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","file":"app.js","sourcesContent":["\nconst express = require('express');\nconst path = require('path');\nconst logger = require('morgan');\nconst bodyParser = require('body-parser');\nconst cookieParser = require('cookie-parser');\nconst passport = require('passport');\nconst graphqlHTTP = require('express-graphql');\nconst routes = require('./routes');\nconst schema = require('./models/schemas');\nconst auth = require('./lib/auth');\n\nconst app = express();\n\nif (app.get('env') === 'production') {\n  app.disable('x-powered-by'); /* hide powerby to prevent secure issue. */\n}\n\n/* View engine setup */\napp.set('views', path.join(__dirname, '/views'));\napp.set('view engine', 'ejs');\n\napp.use(\n  '/assets',\n  express.static(path.join(__dirname, '../public'), {\n    maxAge: app.get('env') === 'production' ? 60 * 60 * 24 * 365 * 1000 : 0,\n    setHeaders: res => res.setHeader('x-timestamp', Date.now()),\n  })\n);\n\napp.use(logger('dev', {\n  skip: () => app.get('env') === 'test'\n}));\n\n/* Middlewares */\n\nif (process.env.NODE_ENV === 'development') {\n  app.use((res, req, next) => {\n    res.header('Access-Control-Allow-Origin', '*');\n    next();\n  })\n}\n\napp.use(express.static('public'))\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(require('express-session')({ secret: process.env.SECRET_KEY, resave: true, saveUninitialized: true }));\n\napp.use(passport.initialize());\napp.use(passport.session());\n\napp.use('/graphql', graphqlHTTP({\n  schema,\n  graphiql: true\n}))\n\n\nauth.init(app);\nauth.registerRoutes(app);\n\n// Catch 404 and forward to error handler\napp\n  .use('/', routes)\n  .use((req, res, next) => {\n    const err = new Error('Not Found');\n    err.status = 404;\n    if (err.status === 404) {\n      return res.render('index');\n    }\n    next(err);\n  })\n  .use((err, req, res, next) => {\n    console.warn(err.stack); // eslint-disable-line no-console\n    console.log(err.message); // eslint-disable-line no-console\n\n    switch (req.accepts(['application/json', 'html'])) {\n      case 'application/json':\n        return res.status(err.status || 500).json({\n          error: err,\n          message: err.message,\n          name: err.name,\n        });\n      case 'html':\n        return res\n          .status(err.status || 500)\n          .render('error', {\n            error: err,\n            name: err.name,\n            stack: err.stack,\n            message: err.message\n          });\n    } \n  });\n\napp.get('*', (req, res) => {\n  if (req.accepts(['application/json'])) {\n    res.status(404);\n    res.text('Not Found');\n  }\n\n  return res.render('index');\n})\n\nmodule.exports = app;\n\n"]}